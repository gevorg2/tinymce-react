import * as Body from 'ephox/sugar/api/node/Body';
import * as Css from 'ephox/sugar/api/properties/Css';
import * as DomEvent from 'ephox/sugar/api/events/DomEvent';
import Element from 'ephox/sugar/api/node/Element';
import * as Html from 'ephox/sugar/api/properties/Html';
import * as Insert from 'ephox/sugar/api/dom/Insert';
import * as Remove from 'ephox/sugar/api/dom/Remove';
import * as Traverse from 'ephox/sugar/api/search/Traverse';
import { UnitTest, assert } from '@ephox/bedrock-client';
UnitTest.asynctest('CssReflowTest', function (success, failure) {
    var iframe = Element.fromHtml('<iframe style="height:100px; width:500px;" src="/project/@ephox/sugar/src/test/data/cssReflowTest.html"></iframe>');
    Insert.append(Body.body(), iframe);
    var run = DomEvent.bind(iframe, 'load', function () {
        run.unbind();
        try {
            checks();
            success();
        }
        catch (e) {
            failure(e);
        }
        finally {
            Remove.remove(iframe);
        }
    });
    var checks = function () {
        var iframeWin = iframe.dom().contentWindow;
        var iframeDoc = iframeWin.document;
        var styles = Element.fromTag('style', iframeDoc);
        Html.set(styles, 'span.style {border-left-style: solid; }');
        Insert.append(Element.fromDom(iframeDoc.head), styles);
        var reflowTest = Element.fromTag('div', iframeDoc);
        Insert.append(Element.fromDom(iframeDoc.body), reflowTest);
        Html.set(reflowTest, '<span class="style">text</span>');
        var newspan = Traverse.firstChild(reflowTest).getOrDie('test broke');
        Css.reflow(newspan);
        // TODO: I can't actually make this fail without a reflow, we need a more stressful test. But you get the idea.
        assert.eq('solid', Css.get(newspan, 'border-left-style'));
        Remove.remove(newspan);
    };
});
//# sourceMappingURL=CssReflowTest.js.map