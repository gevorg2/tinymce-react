import { addStackTrace } from '../api/TestLogs';
import { setTimeout } from '@ephox/dom-globals';
var callAsync = function (f) {
    // tslint:disable-next-line:no-unimported-promise
    typeof Promise !== 'undefined' ? Promise.resolve().then(f) : setTimeout(f, 0);
};
export var Pipe = function (f) {
    return function (value, next, die, logs) {
        var bounceNext = function (value, nextLogs) { return callAsync(function () {
            next(value, nextLogs);
        }); };
        try {
            f(value, bounceNext, die, logs);
        }
        catch (err) {
            var logsWithTrace = addStackTrace(logs, err);
            die(err, logsWithTrace);
        }
    };
};
//# sourceMappingURL=Pipe.js.map